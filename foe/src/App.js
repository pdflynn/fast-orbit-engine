import React, { useState, useEffect } from "react";
import { Canvas, useThree } from "@react-three/fiber";
import { OrbitControls, Stars } from "@react-three/drei";
import "./styles.css";
import Sphere from "./components/viewpane/Sphere";
import OrbitTrace from "./components/viewpane/OrbitTrace";
import Orbits from "./components/control-pane/Orbits";
import OrbitAnimation from "./components/viewpane/OrbitAnimation";
import OrbitVisualizations from "./components/viewpane/OrbitVisualizations";
import SimulationTime from "./components/control-pane/SimulationTime";
import AddOrbit from "./components/control-pane/AddOrbit";
import ShowAddOrbit from "./components/control-pane/ShowAddOrbit";
import ShowStars from "./components/control-pane/ShowStars";

// dummy data. TODO: pull planetary radii from FOE backend API
const R_EARTH = 6.371;
var TIME_CONST = 1000; // hundreds of seconds per second of simulation time

// Time variable increases by 10 every 10 ms.
var time = 0;
var nextOrbitKey = 1;
time = setInterval(() => {time += (TIME_CONST / 100)}, 10);


  export function getGlobalTime() {
    return time;
  }


function App() {

  const [showAddOrbit, setShowAddOrbit] = useState(false);
  const [showStars, setShowStars] = useState(true);

  const updateTimeConstant = (simTimeMult) => {
    TIME_CONST = parseFloat(simTimeMult.simTimeMult);
  }

  getGlobalTime();

  // Temporary hard-coded orbital parameters
  const [orbits, setOrbits] = useState([
    {
      id: 0,
      text: 'Example Orbit',
      sma: 10000,
      ecc: 0,
      inc: 15,
      raan: 0,
      argp: 0,
      trueAnomaly: 0,
    },
  ])

  const [orbitVisualizations, setOrbitVisualizations] = useState([
    {
      id: 0,
      t: [0.0, 30.0, 60.0, 90.0, 120.0, 150.0, 180.0, 210.0, 240.0, 270.0, 300.0, 330.0, 360.0, 390.0, 420.0, 450.0, 480.0, 510.0, 540.0, 570.0, 600.0, 630.0, 660.0, 690.0, 720.0, 750.0, 780.0, 810.0, 840.0, 870.0, 900.0, 930.0, 960.0, 990.0, 1020.0, 1050.0, 1080.0, 1110.0, 1140.0, 1170.0, 1200.0, 1230.0, 1260.0, 1290.0, 1320.0, 1350.0, 1380.0, 1410.0, 1440.0, 1470.0, 1500.0, 1530.0, 1560.0, 1590.0, 1620.0, 1650.0, 1680.0, 1710.0, 1740.0, 1770.0, 1800.0, 1830.0, 1860.0, 1890.0, 1920.0, 1950.0, 1980.0, 2010.0, 2040.0, 2070.0, 2100.0, 2130.0, 2160.0, 2190.0, 2220.0, 2250.0, 2280.0, 2310.0, 2340.0, 2370.0, 2400.0, 2430.0, 2460.0, 2490.0, 2520.0, 2550.0, 2580.0, 2610.0, 2640.0, 2670.0, 2700.0, 2730.0, 2760.0, 2790.0, 2820.0, 2850.0, 2880.0, 2910.0, 2940.0, 2970.0, 3000.0, 3030.0, 3060.0, 3090.0, 3120.0, 3150.0, 3180.0, 3210.0, 3240.0, 3270.0, 3300.0, 3330.0, 3360.0, 3390.0, 3420.0, 3450.0, 3480.0, 3510.0, 3540.0, 3570.0, 3600.0, 3630.0, 3660.0, 3690.0, 3720.0, 3750.0, 3780.0, 3810.0, 3840.0, 3870.0, 3900.0, 3930.0, 3960.0, 3990.0, 4020.0, 4050.0, 4080.0, 4110.0, 4140.0, 4170.0, 4200.0, 4230.0, 4260.0, 4290.0, 4320.0, 4350.0, 4380.0, 4410.0, 4440.0, 4470.0, 4500.0, 4530.0, 4560.0, 4590.0, 4620.0, 4650.0, 4680.0, 4710.0, 4740.0, 4770.0, 4800.0, 4830.0, 4860.0, 4890.0, 4920.0, 4950.0, 4980.0, 5010.0, 5040.0, 5070.0, 5100.0, 5130.0, 5160.0, 5190.0, 5220.0, 5250.0, 5280.0, 5310.0, 5340.0, 5370.0, 5400.0, 5430.0, 5460.0, 5490.0, 5520.0, 5550.0, 5580.0, 5610.0, 5640.0, 5670.0, 5700.0, 5730.0, 5760.0, 5790.0, 5820.0, 5850.0, 5880.0, 5910.0, 5940.0, 5970.0, 6000.0, 6030.0, 6060.0, 6090.0, 6120.0, 6150.0, 6180.0, 6210.0, 6240.0, 6270.0, 6300.0, 6330.0, 6360.0, 6390.0, 6420.0, 6450.0, 6480.0, 6510.0, 6540.0, 6570.0, 6600.0, 6630.0, 6660.0, 6690.0, 6720.0, 6750.0, 6780.0, 6810.0, 6840.0, 6870.0, 6900.0, 6930.0, 6960.0, 6990.0, 7020.0, 7050.0, 7080.0, 7110.0, 7140.0, 7170.0, 7200.0, 7230.0, 7260.0, 7290.0, 7320.0, 7350.0, 7380.0, 7410.0, 7440.0, 7470.0, 7500.0, 7530.0, 7560.0, 7590.0, 7620.0, 7650.0, 7680.0, 7710.0, 7740.0, 7770.0, 7800.0, 7830.0, 7860.0, 7890.0, 7920.0, 7950.0, 7980.0, 8010.0, 8040.0, 8070.0, 8100.0, 8130.0, 8160.0, 8190.0, 8220.0, 8250.0, 8280.0, 8310.0, 8340.0, 8370.0, 8400.0, 8430.0, 8460.0, 8490.0, 8520.0, 8550.0, 8580.0, 8610.0, 8640.0, 8670.0, 8700.0, 8730.0, 8760.0, 8790.0, 8820.0, 8850.0, 8880.0, 8910.0, 8940.0, 8970.0, 9000.0, 9030.0, 9060.0, 9090.0, 9120.0, 9150.0, 9180.0, 9210.0, 9240.0, 9270.0, 9300.0, 9330.0, 9360.0, 9390.0, 9420.0, 9450.0, 9480.0, 9510.0, 9540.0, 9570.0, 9600.0, 9630.0, 9660.0, 9690.0, 9720.0, 9750.0, 9780.0, 9810.0, 9840.0, 9870.0, 9900.0, 9930.0, 9960.0],
      x: [10.0, 9.998203349895787, 9.992823134309216, 9.983858870255832, 9.971313200265431, 9.955191519529516, 9.935498316934348, 9.912241680425096, 9.88542903329283, 9.855070161895807, 9.82117536016898, 9.78375693981166, 9.742827670262688, 9.698402645803766, 9.650498640371891, 9.599132278936723, 9.544323066755158, 9.48609002837008, 9.42445444091907, 9.359438211195483, 9.291064552117575, 9.219358121539466, 9.14434447665923, 9.066050363142935, 8.984503789955863, 8.89973409227607, 8.811771702290494, 8.720648239208504, 8.62639651428827, 8.529050359504252, 8.428644460954354, 8.325214856409403, 8.218798728979682, 8.10943439930237, 7.99716110553097, 7.882018857655378, 7.764048985030048, 7.643293897123497, 7.5197970778238625, 7.393602813373932, 7.264756087105454, 7.133303154073475, 6.999291276565753, 6.862768720633384, 6.723774256082384, 6.582384670764701, 6.438629334176332, 6.292562276108368, 6.144237526351899, 5.99371194042201, 5.841037405344223, 5.686263377997058, 5.529448491064134, 5.370650705441674, 5.209926739482382, 5.047334041922411, 4.882930651837084, 4.716776148885445, 4.54893006597188, 4.379451469559461, 4.208401730377581, 4.0358428221092275, 3.861835743724614, 3.6864429611546026, 3.5097282676948653, 3.3317543434434382, 3.1525853183258823, 2.9722847027194472, 2.7909182663189287, 2.6085500222947315, 2.4252456173273407, 2.2410709080078415, 2.0560923603617067, 1.8703768030410322, 1.6839902838940877, 1.4969996366756224, 1.30947207972378, 1.1214747744434317, 0.933075109635076, 0.7443407701009194, 0.5553394681303204, 0.36613888336053735, 0.17680695239819966, -0.01258830637525214, -0.2019790356506913, -0.3912973139906001, -0.5804752454226493, -0.7694449473647693, -0.9581386197985735, -1.1464885993602276, -1.3344272897759173, -1.5218873070128611, -1.7088013692362278, -1.8951024655089892, -2.0807237388500224, -2.265598637396735, -2.4496608890870912, -2.6328444262527584, -2.8150834724749996, -2.9963125821723295, -3.1764667581765766, -3.3554813938645736, -3.533292314265678, -3.7098358238521034, -3.8850486465771494, -4.058867812622318, -4.231230966866499, -4.4020762884579545, -4.571342509061851, -4.738968902152835, -4.904895324907842, -5.069062258670956, -5.231410819456336, -5.391882776978709, -5.550420556243887, -5.706967285032513, -5.861466810620726, -6.01386371909841, -6.164103344552811, -6.312131781658407, -6.457895931779723, -6.601343512883941, -6.742423077876973, -6.881083985059498, -7.01727647362154, -7.150951689828659, -7.282061691475104, -7.410559467922788, -7.536398960140286, -7.659535080741819, -7.779923667043042, -7.897521408997259, -8.012286113499053, -8.124176619586663, -8.2331528098926, -8.339175628666293, -8.442207099796756, -8.542210336964986, -8.639149352781823, -8.732989298180453, -8.823696512396879, -8.911238470443315, -8.995583798614172, -9.07670228999204, -9.154564919953668, -9.229143774007312, -9.300411928395398, -9.368343804651008, -9.43291504288078, -9.494102504334625, -9.551884284147345, -9.606239724080213, -9.657149416896152, -9.704594965034433, -9.748559253916172, -9.789026514824373, -9.825982247742413, -9.859413231008075, -9.88930753096758, -9.91565451162961, -9.938444745936762, -9.95766985696939, -9.973322930863233, -9.985398361237767, -9.993891842182684, -9.998800374659135, -10.000122272900915, -9.997857166743062, -9.992005839990957, -9.982570309746519, -9.969553884070313, -9.952961129294032, -9.93279804225172, -9.909071896542532, -9.881791252374878, -9.850965952750135, -9.816607002261408, -9.778726716852363, -9.737338681290558, -9.692457738779014, -9.644099988853082, -9.59228277995181, -9.537024706822434, -9.478345589566947, -9.41626647024389, -9.350809621740986, -9.281998502013149, -9.20985787844777, -9.134413544748371, -9.055692583420175, -8.973723244348806, -8.888534921525935, -8.800158174341085, -8.708624708129618, -8.613967340772989, -8.516220049128272, -8.41541788962308, -8.31159700775915, -8.204794673921015, -8.095049172599348, -7.982399876178442, -7.8668872186217405, -7.748552590674399, -7.627438474896897, -7.503588230483602, -7.377046184162148, -7.2478577486706275, -7.116069316413666, -6.981728242939448, -6.844882830416755, -6.705582310853142, -6.563876609477666, -6.419816431621329, -6.273453450932692, -6.124840154952894, -5.974029824603053, -5.821076513671666, -5.666035028345824, -5.508961002135745, -5.3499108362142795, -5.188941581729806, -5.026110982446173, -4.86147745600844, -4.695100075208604, -4.527038549246779, -4.3573531377245365, -4.186104655185064, -4.013354527290299, -3.839164724997579, -3.6635977445341847, -3.486716587371885, -3.308584740201485, -3.1292660786927975, -2.948824868559488, -2.767325838276039, -2.584834102538199, -2.401415140725518, -2.2171347753660307, -2.03205915060094, -1.8462546383833727, -1.6597878317045485, -1.472725618776702, -1.2851351048229793, -1.0970835890364417, -0.9086385415659114, -0.7198675805018262, -0.530838423796362, -0.3416188594325208, -0.15227675676390517, 0.03711997493441589, 0.2265034084223665, 0.41580560008409734, 0.6049586394298773, 0.79389466974099, 0.9825459087577945, 1.1708446820466942, 1.3587234500136334, 1.5461148177769723, 1.7329515662727335, 1.9191666759531965, 2.1046933444100375, 2.289465018031352, 2.4734154153761216, 2.6564785504085418, 2.8385887538313934, 3.0196806961121796, 3.1996894160178178, 3.3785503425367867, 3.55619953571355, 3.732572662079118, 3.9076069524543775, 4.081239538725744, 4.253408106628589, 4.42405089286702, 4.593106682636061, 4.760514819828188, 4.926215272223056, 5.090148584737635, 5.252255929691602, 5.412479191819283, 5.570760854777635, 5.727044164168532, 5.881273055074538, 6.033392171622582, 6.183346991507657, 6.331083681614751, 6.476549335312123, 6.619691803732191, 6.760459692861593, 6.89880243575785, 7.0346703170091285, 7.168014508828271, 7.298787201335986, 7.426941497510626, 7.552431456273047, 7.675212137968635, 7.7952396312935806, 7.912470998381747, 8.026863953729343, 8.138377420645776, 8.246971403558987, 8.352606967567253, 8.455246256343326, 8.554852467983801, 8.651389792371427, 8.74482359106131, 8.835120351592519, 8.922247697440241, 9.006174403121596, 9.086870359436118, 9.164306559940256, 9.238455224479534, 9.309289761870488, 9.376784781944613, 9.440916108422314, 9.50166071398906, 9.558996754940106, 9.612903663084975, 9.663362109711397, 9.710354016079679, 9.75386256215547, 9.793872108724969, 9.830368268020218, 9.863337947621348, 9.89276932792463, 9.918651869703911, 9.940976285552743, 9.959734528111715, 9.974919868435263, 9.986526868881198, 9.99455138825281, 9.99899056747583, 9.999842763206756],
      y: [0.0, 0.18293963779077088, 0.36581365637137686, 0.5485564732453364, 0.7311025333810345, 0.9133864101629201, 1.0953426652319798, 1.2769060979605962, 1.458011531066365, 1.6385939953666053, 1.8185886609138016, 1.9979309514480006, 2.1765564177099206, 2.354401059082183, 2.53140106035351, 2.7074929656188433, 2.8826135991295843, 3.0567001940523633, 3.229690233074602, 3.4015217554221557, 3.572133017671019, 3.7414630440516077, 3.9094509742431978, 4.076036364242664, 4.24115941837319, 4.404761258863226, 4.566783168729965, 4.727166889116149, 4.885854635893341, 5.042789433864024, 5.197915441718543, 5.3511769815123555, 5.502518941141255, 5.651886789580553, 5.7992269258863836, 5.944486910286784, 6.087614595641478, 6.228558506963297, 6.36726785045126, 6.50369287836892, 6.637785030220837, 6.769496162085064, 6.898778901333166, 7.025586651283155, 7.149864465992235, 7.271593544772141, 7.3907101861571975, 7.507173728125227, 7.6209435086540545, 7.731976955433382, 7.84023606937409, 7.945685833466838, 8.04828607603603, 8.14799866832569, 8.244788474138645, 8.338620584682344, 8.429461234157172, 8.517278895687014, 8.602042001417388, 8.68371829472811, 8.762279561533028, 8.837698645549242, 8.909946680487709, 8.978997926089441, 9.04482947065276, 9.107416030299706, 9.16673597865279, 9.222766126760641, 9.275488983937136, 9.324882834635938, 9.370930948614529, 9.413616940738562, 9.452926073222132, 9.488845000769874, 9.521360024002018, 9.550459482583753, 9.576133150548332, 9.598371726551006, 9.617167138861143, 9.632512618954191, 9.644402657165118, 9.652833013631662, 9.65780066559339, 9.659303830850734, 9.657341974151988, 9.651915801203431, 9.643027259045276, 9.63067953664795, 9.614877063790649, 9.595625510259035, 9.572931785030029, 9.546804027225656, 9.517251614496441, 9.484285144112913, 9.447916446876645, 9.408158562171597, 9.365025742156584, 9.318533466873138, 9.268698430110538, 9.215538530542098, 9.159072820304717, 9.09932154931493, 9.036306155575838, 8.970049251837345, 8.900574609550532, 8.827907137169374, 8.752072903185152, 8.673099117909947, 8.591014125285193, 8.505847361584625, 8.41762936550073, 8.326391786836298, 8.232167365927088, 8.13498991771437, 8.034894280724847, 7.931916358396635, 7.8260930985039545, 7.717462477808686, 7.606063468307032, 7.491936009787361, 7.375121044481756, 7.255660484663373, 7.133597197018305, 7.008974924428605, 6.881838345248872, 6.752233068039067, 6.620205597849128, 6.48580332290519, 6.349074501295808, 6.210068247658168, 6.068834438793743, 5.925423588881392, 5.779887131800049, 5.632277280929897, 5.48264700544399, 5.331050014554071, 5.177540741756398, 5.022174321921436, 4.865006385608139, 4.706093244593529, 4.5454919051766245, 4.383259988276328, 4.2194557113889335, 4.054137870545631, 3.8873658222700063, 3.719199404054224, 3.5496988217099097, 3.3789248690990816, 3.206938810351726, 3.0338023527512155, 2.859577626753173, 2.6843271660043286, 2.508113883165393, 2.3310009225084167, 2.153051770615579, 1.9743302615438494, 1.7949005117549826, 1.6148268985858807, 1.4341740387189543, 1.253006766652485, 1.071390079783202, 0.8893890597102386, 0.7070689875597836, 0.5244952663833284, 0.34173339397161917, 0.1588489402211222, -0.024092475499510737, -0.20702520780853217, -0.38988364200591585, -0.5726022019244946, -0.7551153621725466, -0.9373576778720618, -1.1192637652775115, -1.3007683637602758, -1.481806356961178, -1.662312794618633, -1.8422229360224898, -2.02147224803477, -2.1999964353517867, -2.377731461219336, -2.55461356567439, -2.7305792986204795, -2.905565539289928, -3.0795095175204596, -3.25234883693213, -3.424021499362399, -3.594466024961063, -3.763620995025309, -3.9314259713010413, -4.0978207137250795, -4.262745523721599, -4.426141243993164, -4.587949258711895, -4.748111522071777, -4.906570607879801, -5.063269635817148, -5.218152406460374, -5.371163384797238, -5.522247637130474, -5.671351008607549, -5.818420006957518, -5.963401839210663, -6.106244561250344, -6.246896887302008, -6.385308455958863, -6.5214297216581265, -6.655211819369847, -6.786606692327945, -6.915567114670133, -7.042046714077824, -7.165999994559174, -7.28738248078224, -7.406150683541683, -7.522262009195845, -7.635674858554622, -7.746348651725305, -7.854243852958423, -7.959321995288267, -8.061545258232714, -8.160876676056418, -8.257280617902659, -8.350722516754267, -8.44116888594752, -8.528587335686048, -8.61294658954338, -8.694216333821059, -8.772367291893874, -8.84737142686072, -8.919201841053363, -8.987832789342033, -9.053239692441025, -9.11539915021432, -9.174288823436695, -9.22988748350072, -9.28217518579339, -9.331133185459855, -9.37674394809931, -9.418991160464618, -9.45785974116193, -9.493335705434069, -9.525406205665933, -9.55405973535417, -9.57928602537156, -9.601076051626427, -9.619422042776241, -9.634317487941262, -9.645757051184004, -9.653736553867374, -9.658253110150605, -9.659305066132406, -9.656892007465052, -9.651014814594172, -9.64167560604644, -9.628877749144168, -9.612625870619006, -9.59292580412268, -9.569784574758248, -9.543210483486362, -9.51321306781469, -9.479803096896784, -9.442992536990385, -9.402794585824676, -9.359223666298615, -9.312295419491212, -9.262026677574864, -9.208435451441353, -9.15154096620604, -9.091363639238446, -9.027925012362692, -8.96124798151993, -8.89135632227618, -8.818275131217595, -8.74203064412069, -8.662650216059781, -8.580162304293854, -8.494596498904645, -8.405983481911926, -8.31435504789356, -8.219744075428931, -8.122184480902849, -8.021711281280025, -7.918360501249671, -7.812169214855757, -7.70317553140719, -7.59141851716956, -7.476938286732705, -7.359775831685537, -7.239973147080801, -7.1175732359234996, -6.992620057168395, -6.865158509627946, -6.735234398401362, -6.602894259796938, -6.468185539811573, -6.331156550057016, -6.191856420084685, -6.05033507758804, -5.90664325048737, -5.760832540181685, -5.612955260165525, -5.4630644575742595, -5.3112139060535615, -5.157458088374145, -5.001852163452138, -4.8444519190980335, -4.685313814696144, -4.524494940238531, -4.362052995991072, -4.198046274070537, -4.032533607805204, -3.8655743348141334, -3.6972283486352295, -3.5275560464328595, -3.356618308596757, -3.1844764788795503, -3.0111922992140285, -2.8368279025329937, -2.6614458389450926, -2.4851090273803664, -2.3078807343415635, -2.1298245519905628, -1.9510043435421895, -1.7714842447111276, -1.5913286550725614, -1.410602204348172, -1.2293697300504531, -1.047696245993609, -0.8656469150488931, -0.6832870446933548, -0.5006820558867323, -0.31789746010400516, -0.13499883275019134, 0.04794822317416605],
      z: [0.0, 0.049018528209679155, 0.09801947380498668, 0.14698526400895276, 0.1958983334037962, 0.24474115098071678, 0.2934961825842628, 0.342145957758918, 0.39067301230449747, 0.43905993778096886, 0.4872893630562501, 0.5353439849736363, 0.5832065344061504, 0.6308598624400508, 0.6782868698410104, 0.7254705536505143, 0.7723939859777439, 0.8190403485003867, 0.865392889755024, 0.9114350074022615, 0.9571501573414988, 1.0025220011645184, 1.0475342313975307, 1.0921706521187113, 1.1364152411247466, 1.1802522221642968, 1.223665862069238, 1.266640550425815, 1.309160804023478, 1.3512113564040635, 1.3927772449337459, 1.4338435507522485, 1.4743955066157555, 1.5144185009802398, 1.5538981715160785, 1.5928204670287236, 1.6311714147340497, 1.6689372219508147, 1.7061042785210656, 1.742659254578996, 1.7785891383790688, 1.8138810297962773, 1.8485222353730901, 1.882500269566197, 1.9158004096545993, 1.94841761800906, 1.9803348258732933, 2.011541137891295, 2.04202565870706, 2.0717769811044255, 2.1007849232581477, 2.1290401023888523, 2.1565317545285043, 2.1832496631077323, 2.2091844134108793, 2.234326651655171, 2.2586673303218694, 2.282198001809981, 2.304910207538388, 2.3267953043717635, 2.3478457323685076, 2.368054215024546, 2.387413017641044, 2.4059152431363917, 2.423554752338626, 2.4403247704530675, 2.4562195027093328, 2.4712327356466273, 2.4853597826497302, 2.498594825055538, 2.5109333800090776, 2.522371057126834, 2.5329039074309745, 2.542528355060384, 2.551240729277316, 2.5590379057044745, 2.5659171443023285, 2.571875952783063, 2.5769121683329743, 2.581023977331374, 2.5842099034679675, 2.5864688106750844, 2.587799889006508, 2.588202660923304, 2.5876769830052093, 2.5862230443456524, 2.5838413666524844, 2.580532804407757, 2.5762985445672286, 2.5711401063453887, 2.565059340997022, 2.558058429393304, 2.5501398842681193, 2.5413065451515484, 2.5315615820973187, 2.520908488997831, 2.5093510847075318, 2.4968935170910465, 2.4835402592357325, 2.46929610707665, 2.454166165618494, 2.438155860810047, 2.4212709369469283, 2.4035174530972125, 2.38490177880202, 2.3654305882614777, 2.345110866506772, 2.323949904519053, 2.3019552970345347, 2.2791349314789953, 2.2554969906704234, 2.231049955147918, 2.205802597658005, 2.179763978886889, 2.1529434337896687, 2.1253505826635886, 2.0969953256349165, 2.0678878385463273, 2.0380385639127323, 2.00745820356817, 1.9761577279506635, 1.9441483674199576, 1.9114416080699743, 1.8780491707706326, 1.8439830270509678, 1.8092553976877885, 1.77387874367167, 1.7378657626395366, 1.7012293853072435, 1.6639827719021618, 1.6261392868729676, 1.5877124654530925, 1.5487160893088598, 1.509164148973324, 1.4690708374936288, 1.4284505462096868, 1.3873178605328615, 1.3456875538071684, 1.3035745321959544, 1.2609938843943966, 1.2179608851942803, 1.1744909740742926, 1.1305997503655516, 1.0863029684171315, 1.0416165327615936, 0.9965564768066402, 0.951138932650876, 0.9053801899605338, 0.8592966644097683, 0.8129048904153262, 0.7662215157826171, 0.7192632963517821, 0.6720470895194524, 0.6245898147423302, 0.5769084831988411, 0.5290201991729996, 0.4809421426189543, 0.43269156339213904, 0.38428577548042336, 0.33574215123526335, 0.287078106656623, 0.2383110803064318, 0.1894585642097334, 0.14053808306135726, 0.09156718694143985, 0.04256344525078716, -0.006455559353762736, -0.05547223724518379, -0.10446900701759235, -0.15342829758995324, -0.20233255148647086, -0.25116423280493366, -0.29990582202352906, -0.348539832609521, -0.3970488166870537, -0.44541537088598754, -0.49362214798532006, -0.541651856382845, -0.589487268203862, -0.6371112248517966, -0.6845066418960458, -0.7316565179345011, -0.7785439398084381, -0.8251520883035658, -0.8714642443602675, -0.917463795620959, -0.9631342686094267, -1.008459206233852, -1.0534224141128583, -1.0980077509701638, -1.142199220620588, -1.1859809719140553, -1.2293372987868223, -1.2722526479120433, -1.3147116319876777, -1.356699009978232, -1.3981997232935788, -1.4391988913720373, -1.4796817947737877, -1.5196339227498277, -1.559040942089356, -1.5978887069587706, -1.6361632989739663, -1.6738509761530689, -1.710938244197798, -1.747411827414618, -1.783258632458215, -1.8184657825569273, -1.853020623579093, -1.8869107300993957, -1.9201239115035618, -1.9526482506623142, -1.9844720946782028, -2.0155840306193427, -2.0459729120163392, -2.075627865519713, -2.1045382975573204, -2.1326939009367645, -2.1600845416904035, -2.186700314879303, -2.2125316732441807, -2.2375693545806996, -2.261804386164359, -2.2852280891753782, -2.3078320831205423, -2.3296082454688296, -2.3505487315721587, -2.37064602896552, -2.389892930440432, -2.408282537610163, -2.4258082644749592, -2.442463840987269, -2.4582432813697377, -2.4731408974341456, -2.4871513450375455, -2.5002696015112176, -2.5124909685266275, -2.523811074962378, -2.534225879771166, -2.5437316357486006, -2.5523249003865907, -2.5600025905268544, -2.5667619545650484, -2.5726005745030927, -2.577516368016034, -2.581507590518903, -2.5845728122515603, -2.5867109135515713, -2.587921121160233, -2.5882029919160296, -2.587556414794823, -2.585981625711309, -2.5834791923229985, -2.5800500169011853, -2.57569533917488, -2.5704167222663497, -2.564216048546286, -2.5570955422503934, -2.5490577589461476, -2.5401055842195484, -2.530242224419691, -2.519471215867454, -2.507796423166964, -2.495222037332712, -2.4817525685316983, -2.467392842767831, -2.452148011395244, -2.4360235452316137, -2.4190252163913155, -2.401159159823293, -2.3824317461712585, -2.362849700045206, -2.342420051300266, -2.3211501297065076, -2.2990475603634977, -2.2761202719097406, -2.252376485567656, -2.227824720668706, -2.2024737870016864, -2.1763327724345145, -2.149411059734607, -2.1217183016883476, -2.0932644322558764, -2.064059662795739, -2.034114461082252, -2.003439575787368, -1.972045990574232, -1.9399449579833121, -1.9071480006350723, -1.8736668972959403, -1.8395136785664556, -1.8047006178859613, -1.769240184620683, -1.7331450918871742, -1.6964282847427883, -1.6591029274111515, -1.621182397977407, -1.58268028894683, -1.5436104268726134, -1.5039868291133722, -1.4638237096061897, -1.423135476955998, -1.3819367297772114, -1.3402422478568614, -1.298066979493718, -1.255426052934212, -1.2123347653956127, -1.1688085776175645, -1.124863108925681, -1.0805141236627638, -1.0357775212959188, -0.9906693502502606, -0.9452057938972059, -0.8994031650880195, -0.8532779008316782, -0.8068465448292119, -0.7601257455497886, -0.7131322632445066, -0.6658829569898593, -0.6183947789941657, -0.5706847687258463, -0.5227700382817397, -0.4746677727748013, -0.42639522801919477, -0.3779697214966516, -0.3294086263662836, -0.2807293630271037, -0.2319493918178409, -0.18308621182423018, -0.1341573525396015, -0.08518036771077056, -0.03617282821455528, 0.012847687678027665],
    }
  ])

  // Add orbit
  const addOrbit = (orbit) => {
    nextOrbitKey++;
    const id = nextOrbitKey;
    const newOrbit = {id, ...orbit};
    // console.log(id);
    // console.log(newOrbit);
    setOrbits([...orbits, newOrbit]);
    setShowAddOrbit(!showAddOrbit)

    // post request
    fetch('/new_orbit', {
      method: 'POST',
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(newOrbit)
    }).then(
      (response) => response.json()
    ).then(
      actualData => {
        setOrbitVisualizations([...orbitVisualizations, actualData])
      })
  }

  // Delete orbit
  const deleteOrbit = (id) => {
    setOrbits(orbits.filter((orbit) => orbit.id !== id));
    setOrbitVisualizations(orbitVisualizations.filter((orbitVisualization) => orbitVisualization.id !== id));
  }


  return (
    <>
    {/* TODO: give this its own header */}
      <h2 style={{position: 'absolute', right: '1%'}}>FOE: Fast Orbit Engine</h2>

      {showAddOrbit && <AddOrbit onAdd={addOrbit} onClose={() => setShowAddOrbit(!showAddOrbit)}/>}

      <div className='control-pane'>
          <SimulationTime updateTime = {updateTimeConstant}/>
          <ShowAddOrbit title='Add Orbit' onAdd={() => setShowAddOrbit(!showAddOrbit)} showAdd={showAddOrbit}/>
          <ShowStars title='Show Stars' onClick={() => setShowStars(!showStars)} showStars={showStars}/>
          {orbits.length > 0 ? <Orbits orbits={orbits} onDelete={deleteOrbit}/> : 'Add an orbit.'}
      </div>

      <div className='view-pane'>
        <Canvas gl={{antialias: true}}>
          <color attach="background" args={["black"]} />
          <OrbitControls minDistance={10} maxDistance={75} enablePan={false}/>

          {showStars ? <Stars radius={150} depth={80} count={2000} factor={3} saturation={0.4}/> : ''}

          <ambientLight intensity={0.8} />
          <Sphere radius={R_EARTH} />
          <spotLight position={[150, 0, 0]} intensity={1}/>

          {orbitVisualizations.length > 0 ? <OrbitVisualizations orbitTraces={orbitVisualizations}/> : ''}

        </Canvas>
      </div>
    </>
  );
}

export default App;